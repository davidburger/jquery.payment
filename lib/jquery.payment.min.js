(function(){var t,e,n,r,a,i,o,u,p,s,l,c,h,v,f,d,g,m,y,C,S,D,T,x,w,$,k,E,b,L,N,M,j=[].slice,Y=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=window.jQuery||window.Zepto||window.$,t.payment={},t.payment.fn={},t.fn.payment=function(){var e,n;return n=arguments[0],e=2<=arguments.length?j.call(arguments,1):[],t.payment.fn[n].apply(this,e)},a=/(\d{1,4})/g,t.payment.expiryDateSep=" / ",t.payment.expiryDateSepNoSpace="/",t.payment.setExpiryDateSep=function(e){return t.payment.expiryDateSep=e,t.payment.expiryDateSepNoSpace=e.replace(/\s+/g,""),t.payment},t.payment.cards=r=[{type:"elo",patterns:[401178,401179,431274,438935,451416,457393,457631,457632,504175,506699,5067,509,627780,636297,636368,650,6516,6550],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"visaelectron",patterns:[4026,417500,4405,4508,4844,4913,4917],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",patterns:[5018,502,503,506,56,58,639,6220,67],format:a,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:a,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:a,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:a,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:a,length:[16],cvcLength:[3],luhn:!0}],e=function(t){var e,n,a,i,o,u,p,s;for(t=(t+"").replace(/\D/g,""),i=0,u=r.length;u>i;i++)for(e=r[i],s=e.patterns,o=0,p=s.length;p>o;o++)if(a=s[o],n=a+"",t.substr(0,n.length)===n)return e},n=function(t){var e,n,a;for(n=0,a=r.length;a>n;n++)if(e=r[n],e.type===t)return e},g=function(t){var e,n,r,a,i,o;for(r=!0,a=0,n=(t+"").split("").reverse(),i=0,o=n.length;o>i;i++)e=n[i],e=parseInt(e,10),(r=!r)&&(e*=2),e>9&&(e-=9),a+=e;return a%10===0},d=function(t){var e;if("number"!==t.attr("type")){if(null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd"))return!0;if(null!=("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)?e.createRange:void 0)&&document.selection.createRange().text)return!0}return!1},N=function(t,e){var n,r,a,i,o,u;try{r=e.prop("selectionStart")}catch(p){i=p,r=null}return o=e.val(),e.val(t),null!==r&&e.is(":focus")?(r===o.length&&(r=t.length),o!==t&&(u=o.slice(r-1,+r+1||9e9),n=t.slice(r-1,+r+1||9e9),a=t[r],/\d/.test(a)&&u===""+a+" "&&n===" "+a&&(r+=1)),e.prop("selectionStart",r),e.prop("selectionEnd",r)):void 0},x=function(t){var e,n,r,a,i,o,u,p;for(null==t&&(t=""),r="０１２３４５６７８９",a="0123456789",o="",e=t.split(""),u=0,p=e.length;p>u;u++)n=e[u],i=r.indexOf(n),i>-1&&(n=a[i]),o+=n;return o},T=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var t;return t=n.val(),t=x(t),t=t.replace(/\D/g,""),N(t,n)})},y=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var e;return e=n.val(),e=x(e),e=t.payment.formatCardNumber(e),N(e,n)})},u=function(n){var r,a,i,o,u,p,s;return i=String.fromCharCode(n.which),!/^\d+$/.test(i)||(r=t(n.currentTarget),s=r.val(),a=e(s+i),o=(s.replace(/\D/g,"")+i).length,p=16,a&&(p=a.length[a.length.length-1]),o>=p||null!=r.prop("selectionStart")&&r.prop("selectionStart")!==s.length)?void 0:(u=a&&"amex"===a.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,u.test(s)?(n.preventDefault(),setTimeout(function(){return r.val(s+" "+i)})):u.test(s+i)?(n.preventDefault(),setTimeout(function(){return r.val(s+i+" ")})):void 0)},i=function(e){var n,r;return n=t(e.currentTarget),r=n.val(),8!==e.which||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==r.length?void 0:/\d\s$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d\s$/,""))})):/\s\d?$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d$/,""))})):void 0},S=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var e;return e=n.val(),e=x(e),e=t.payment.formatExpiryMonth(e),N(e,n)})},D=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var e;return e=n.val(),e=x(e),e=t.payment.formatExpiryYear(e),N(e,n)})},C=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var e;return e=n.val(),e=x(e),e=t.payment.formatExpiry(e),N(e,n)})},p=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val()+r,/^\d$/.test(a)&&"0"!==a&&"1"!==a?(e.preventDefault(),setTimeout(function(){return n.val("0"+a+t.payment.expiryDateSep)})):/^\d\d$/.test(a)?(e.preventDefault(),setTimeout(function(){var e,r;return e=parseInt(a[0],10),r=parseInt(a[1],10),r>2&&0!==e?n.val("0"+e+t.payment.expiryDateSep+(""+r)):n.val(""+a+t.payment.expiryDateSep)})):void 0):void 0},s=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val()+r,/^\d$/.test(a)&&"0"!==a&&"1"!==a?(e.preventDefault(),setTimeout(function(){return n.val("0"+a)})):/^\d\d$/.test(a)?(e.preventDefault(),setTimeout(function(){return n.val(""+a)})):void 0):void 0},l=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val()+r,/^\d\d$/.test(a)?(e.preventDefault(),setTimeout(function(){return n.val(""+a)})):void 0):void 0},c=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val(),/^\d\d$/.test(a)?n.val(""+a+t.payment.expiryDateSep):void 0):void 0},h=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val(),/^\d\d$/.test(a)?n.val(""+a):void 0):void 0},v=function(e){var n,r,a;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),a=n.val(),/^\d\d$/.test(a)?n.val(""+a):void 0):void 0},f=function(e){var n,r,a;return a=String.fromCharCode(e.which),a===t.payment.expiryDateSepNoSpace||" "===a?(n=t(e.currentTarget),r=n.val(),/^\d$/.test(r)&&"0"!==r?n.val("0"+r+t.payment.expiryDateSep):void 0):void 0},o=function(e){var n,r,a;return n=t(e.currentTarget),a=n.val(),8!==e.which||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==a.length?void 0:(r=new RegExp("\\d\\s"+t.payment.expiryDateSepNoSpace+"\\s"),r.test(a)?(e.preventDefault(),setTimeout(function(){return n.val(a.replace(r,""))})):void 0)},m=function(e){var n;return n=t(e.currentTarget),setTimeout(function(){var t;return t=n.val(),t=x(t),t=t.replace(/\D/g,"").slice(0,4),N(t,n)})},L=function(t){var e;return t.metaKey||t.ctrlKey?!0:32===t.which?!1:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))},$=function(n){var r,a,i,o;return r=t(n.currentTarget),i=String.fromCharCode(n.which),/^\d+$/.test(i)&&!d(r)?(o=(r.val()+i).replace(/\D/g,""),a=e(o),a?o.length<=a.length[a.length.length-1]:o.length<=16):void 0},k=function(e){var n,r,a;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!d(n)?(a=n.val()+r,a=a.replace(/\D/g,""),a.length>6?!1:void 0):void 0},E=function(e){var n,r,a;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!d(n)?(a=n.val()+r,a=a.replace(/\D/g,""),a.length>2?!1:void 0):void 0},b=function(e){var n,r,a;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!d(n)?(a=n.val()+r,a=a.replace(/\D/g,""),a.length>4?!1:void 0):void 0},w=function(e){var n,r,a;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!d(n)?(a=n.val()+r,a.length<=4):void 0},M=function(e){var n,a,i,o,u;return n=t(e.currentTarget),u=n.val(),o=t.payment.cardType(u)||"unknown",n.hasClass(o)?void 0:(a=function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)i=r[t],n.push(i.type);return n}(),n.removeClass("unknown"),n.removeClass(a.join(" ")),n.addClass(o),n.toggleClass("identified","unknown"!==o),n.trigger("payment.cardType",o))},t.payment.fn.formatCardCVC=function(){return this.on("keypress",L),this.on("keypress",w),this.on("paste",m),this.on("change",m),this.on("input",m),this},t.payment.fn.formatCardExpiry=function(){return this.on("keypress",L),this.on("keypress",k),this.on("keypress",p),this.on("keypress",f),this.on("keypress",c),this.on("keydown",o),this.on("change",C),this.on("input",C),this},t.payment.fn.formatCardExpiryMonth=function(){return this.on("keypress",L),this.on("keypress",E),this.on("keypress",s),this.on("keypress",h),this.on("change",S),this.on("input",S),this},t.payment.fn.formatCardExpiryYear=function(){return this.on("keypress",L),this.on("keypress",b),this.on("keypress",l),this.on("keypress",v),this.on("change",D),this.on("input",D),this},t.payment.fn.formatCardNumber=function(){return this.on("keypress",L),this.on("keypress",$),this.on("keypress",u),this.on("keydown",i),this.on("keyup",M),this.on("paste",y),this.on("change",y),this.on("input",y),this.on("input",M),this},t.payment.fn.restrictNumeric=function(){return this.on("keypress",L),this.on("paste",T),this.on("change",T),this.on("input",T),this},t.payment.fn.cardExpiryVal=function(){return t.payment.cardExpiryVal(t(this).val())},t.payment.cardExpiryVal=function(e){var n,r,a,i;return i=e.split(new RegExp("[\\s"+t.payment.expiryDateSepNoSpace+"]+"),2),n=i[0],a=i[1],2===(null!=a?a.length:void 0)&&/^\d+$/.test(a)&&(r=(new Date).getFullYear(),r=r.toString().slice(0,2),a=r+a),n=parseInt(n,10),a=parseInt(a,10),{month:n,year:a}},t.payment.validateCardNumber=function(t){var n,r;return t=(t+"").replace(/\s+|-/g,""),/^\d+$/.test(t)?(n=e(t),n?(r=t.length,Y.call(n.length,r)>=0&&(n.luhn===!1||g(t))):!1):!1},t.payment.validateCardExpiryMonth=function(e){return"object"==typeof e&&"month"in e&&(e=e.month),e?(e=t.trim(e),/^\d+$/.test(e)&&e>=1&&12>=e?!0:!1):!1},t.payment.validateCardExpiry=function(e,n){var r,a,i;return"object"==typeof e&&"month"in e&&(i=e,e=i.month,n=i.year),e&&n?(e=t.trim(e),n=t.trim(n),/^\d+$/.test(e)&&/^\d+$/.test(n)&&e>=1&&12>=e?(2===n.length&&(n=70>n?"20"+n:"19"+n),4!==n.length?!1:(a=new Date(n,e),r=new Date,a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>r)):!1):!1},t.payment.validateCardExpiryYear=function(e){var n,r,a;return e?(e=t.trim(e),/^\d+$/.test(e)?(2===e.length&&(e=70>e?"20"+e:"19"+e),4!==e.length?!1:(a=new Date(e),n=new Date,r=new Date(n.getFullYear()+""),a>=r)):!1):!1},t.payment.validateCardCVC=function(e,r){var a,i;return e=t.trim(e),/^\d+$/.test(e)?(a=n(r),null!=a?(i=e.length,Y.call(a.cvcLength,i)>=0):e.length>=3&&e.length<=4):!1},t.payment.cardType=function(t){var n;return t?(null!=(n=e(t))?n.type:void 0)||null:null},t.payment.formatCardNumber=function(n){var r,a,i,o;return n=n.replace(/\D/g,""),(r=e(n))?(i=r.length[r.length.length-1],n=n.slice(0,i),r.format.global?null!=(o=n.match(r.format))?o.join(" "):void 0:(a=r.format.exec(n),null!=a?(a.shift(),a=t.grep(a,function(t){return t}),a.join(" ")):void 0)):n},t.payment.formatExpiry=function(e){var n,r,a,i;return(r=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(n=r[1]||"",a=r[2]||"",i=r[3]||"",i.length>0?a=t.payment.expiryDateSep:a===" "+t.payment.expiryDateSepNoSpace?(n=n.substring(0,1),a=""):2===n.length||a.length>0?a=t.payment.expiryDateSep:1===n.length&&"0"!==n&&"1"!==n&&(n="0"+n,a=t.payment.expiryDateSep),n+a+i):""},t.payment.formatExpiryMonth=function(t){return 1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t),t},t.payment.formatExpiryYear=function(t){return t}}).call(this);